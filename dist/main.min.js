var e,t,n,a,i,r,o,d,s,l=document.querySelector(".app"),c=new THREE.Clock,u=window.innerWidth/2,p=window.innerHeight/2,m={cameraX:-.134952,cameraY:3.965744,targetX:0,targetY:0,ease:.002,ampX:.075,ampY:.015},R=[],f={playing:!1,playStars:function(){this.playing&&soundin.play()},playWind:function(){this.playing&&soundout.play()},setPlay:function(){music.play(),setSoundIcon(),this.playing=!0},setPause:function(){music.pause(),setSoundIcon(),this.playing=!1}},y={index:-1,prevIndex:null,currentDressSlider:null,content:!1,menu:!1,prevCameraPosition:{endX:null,endY:null,endZ:null,endRX:null,endRY:null,endRZ:null},playing:!1,scroll:!1,next:[[1,2],[3,4],[5,0]],prev:[[1,0],[3,2],[5,4]]},g={mixer:[],animations:[]},E=(i=P,r=300,s=!1,function e(){if(s)return o=arguments,void(d=this);i.apply(this,arguments),s=!0,setTimeout((function(){s=!1,o&&(e.apply(d,o),o=d=null)}),r)}),h=[{startX:-.134952,startY:3.965744,startZ:.182446,endX:-.89,endY:3.024656,endZ:1.1617089999999999,startRX:.013290999999999999,startRY:-.852159,startRZ:-.090948,endRX:-.117688,endRY:-.6060749999999999,endRZ:-.076337,objStartRY:0,objEndRY:8.6,duration:4e3,cubicBezier:"0.055, 0.450, 0.475, 0.765",particles:3},{startX:-.9636509999999999,startY:3.024656,startZ:1.1617089999999999,endX:.017736,endY:2.1849369999999997,endZ:-.090921,startRX:-.11115,startRY:-.641532,startRZ:-.06630699999999999,endRX:-.339515,endRY:-.8219799999999999,endRZ:-.212728,objStartRY:8.6,objEndRY:0,obj3StartRY:0,obj3EndRY:8.6,duration:1500,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{startX:.017736,startY:2.1849369999999997,startZ:-.090921,endX:.028704,endY:1.122112,endZ:1.289866,startRX:-.339515,startRY:-.8219799999999999,startRZ:-.212728,endRX:-.044142999999999995,endRY:.03624,endRZ:.015323,obj3StartRY:8.6,obj3EndRY:0,duration:4e3,cubicBezier:"0.055, 0.450, 0.475, 0.765",particles:4},{startX:.028704,startY:1.122112,startZ:1.289866,endX:.186173,endY:.48657,endZ:-.087522,startRX:-.044142999999999995,startRY:.03624,startRZ:.015323,endRX:-.161496,endRY:.13526,endRZ:-.00245,obj3StartRY:0,obj3EndRY:8.6,obj2StartRY:9.6,obj2EndRY:0,duration:1500,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{startX:.186173,startY:.48657,startZ:-.087522,endX:.086828,endY:-.818143,endZ:1.346854,startRX:-.161496,startRY:.13526,startRZ:-.00245,endRX:.019832,endRY:.083074,endRZ:185e-6,obj2StartRY:0,obj2EndRY:9.6,duration:4e3,cubicBezier:"0.055, 0.450, 0.475, 0.765",particles:5},{startX:.086828,startY:-.818143,startZ:1.346854,endX:-.05933848738366905,endY:-1.6314853361009416,endZ:-.038750361730078176,startRX:.019832,startRY:.083074,startRZ:185e-6,endRX:-.09335365157235163,endRY:.09579747424262565,endRZ:.0011175874673510107,obj2StartRY:9.6,obj2EndRY:0,duration:1500,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{duration:2500,x:.25,z:-.35,y:0,cubicBezier:"0.055, 0.450, 0.475, 0.765"},{duration:1900,x:-.25,z:.35,y:0,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{duration:2500,x:0,z:-.35,y:0,cubicBezier:"0.055, 0.450, 0.475, 0.765"},{duration:1900,x:0,z:.35,y:0,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{duration:2500,x:0,z:-.35,y:0,cubicBezier:"0.055, 0.450, 0.475, 0.765"},{duration:1900,x:0,z:.35,y:0,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{duration:2500,x:-1,z:-2,y:0,rx:-.5,ry:.4,rz:.3,cubicBezier:"0.765, 0.325, 0.280, 0.800"},{duration:2500,cubicBezier:"0.765, 0.325, 0.280, 0.800"}];function w(){document.visibilityState}function Y(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight)}function x(n,a){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=h[n],o=y[a],d=y.menu,s=null;o.forEach((function(e){e[0]===n&&(s=e[1])}));var l=[6,8,10].includes(n),c=[7,9,11].includes(n),u=12===n,p=13===n,g=[0,2,4],E=g.includes(n),w=[1,3,5].includes(n),Y=[];t.children.forEach((function(e,t){return"BezierCircle"===e.name?Y.push(t):""})),i?animateFirstSlider():l||c?animateContent(n):u||p?animateMenu(n):d&&w||animateSlider(n,a);var v=0===n&&"next"===a?r.startX:e.position.x,b=0===n&&"next"===a?r.startY:e.position.y,S=0===n&&"next"===a?r.startZ:e.position.z,P=0===n&&"next"===a?r.startRX:e.rotation.x,X=0===n&&"next"===a?r.startRY:e.rotation.y,C=0===n&&"next"===a?r.startRZ:e.rotation.z;if(r.particles&&E||r.particles&&u){var Z=r.particles,k=R[Z];k?k.reset():z(r.particles)}if((l||c||u||p)&&(r.endRX=e.rotation.x,r.endRY=e.rotation.y,r.endRZ=e.rotation.z,r.objStartRY=r.objEndRY=t.children[Y[0]].rotation.y,r.obj2StartRY=r.obj2EndRY=t.children[Y[1]].rotation.y,r.obj3StartRY=r.obj3EndRY=t.children[Y[2]].rotation.y),(l||c||u)&&(r.endX=e.position.x+r.x,r.endY=e.position.y+r.y,r.endZ=e.position.z+r.z),u){var T=r.rx,H=r.ry,M=r.rz;r.endRX=e.rotation.x+T,r.endRY=e.rotation.y+H,r.endRZ=e.rotation.z+M}if(p){var j=y.prevCameraPosition,L=j.endX,A=j.endY,B=j.endZ,_=j.endRX,q=j.endRY,W=j.endRZ;r.endX=L,r.endY=A,r.endZ=B,r.endRX=_,r.endRY=q,r.endRZ=W}anime.timeline({easing:"cubicBezier(".concat(r.cubicBezier,")"),duration:r.duration,begin:function(){m.targetX=0,m.targetY=0,m.cameraX=r.endX,m.cameraY=r.endY,E&&f.playStars(),w&&!d&&f.playWind(),u&&f.playWind(),y.playing=!0},complete:function(){y.playing=!1,y.index=n,E&&(y.currentDressSlider=g.indexOf(n)+1),null!==s&&x(s,a)}}).add({targets:e.position,x:[v,r.endX],y:[b,r.endY],z:[S,r.endZ]},0).add({targets:e.rotation,x:[P,r.endRX],y:[X,r.endRY],z:[C,r.endRZ]},0).add({targets:t.children[Y[0]].rotation,y:[r.objStartRY,r.objEndRY]},0).add({targets:t.children[Y[1]].rotation,y:[r.obj2StartRY,r.obj2EndRY]},0).add({targets:t.children[Y[2]].rotation,y:[r.obj3StartRY,r.obj3EndRY]},0)}function z(n){if(6===n){var a=e.position.y,i=e.position.x-1,r=e.position.x;R.push(new Partykals.ParticlesSystem({container:t,particles:{offset:new Partykals.Randomizers.SphereRandomizer(.2,.8),startAlpha:1,endAlpha:0,size:new Partykals.Randomizers.MinMaxRandomizer(.017,.027),startAlphaChangeAt:0,ttl:15.5,globalColor:new THREE.Color("#feeaf4"),endColor:new THREE.Color("#ffffff"),worldPosition:!0,blending:"additive",texture:(new THREE.TextureLoader).load("/homepage/img/particle.png")},system:{particlesCount:500,emitters:new Partykals.Emitter({onInterval:500,interval:.2}),ttl:15.5,speed:1,onUpdate:function(e){e.particleSystem.position.y=a,e.particleSystem.position.z=i,e.particleSystem.position.x=r,e.particleSystem.rotation.x+=e.dt/10}}}))}else{var o=3===n?3.2:4===n?1.4:-.6;R.push(new Partykals.ParticlesSystem({container:t,particles:{offset:new Partykals.Randomizers.SphereRandomizer(.2,.8),startAlpha:1,endAlpha:0,size:new Partykals.Randomizers.MinMaxRandomizer(.017,.027),startAlphaChangeAt:0,ttl:5.5,globalColor:new THREE.Color("#feeaf4"),endColor:new THREE.Color("#ffffff"),worldPosition:!0,blending:"additive",texture:(new THREE.TextureLoader).load("/homepage/img/particle.png")},system:{particlesCount:500,emitters:new Partykals.Emitter({onInterval:500,interval:.2}),ttl:5.5,speed:1,onUpdate:function(e){e.particleSystem.position.y=o,e.particleSystem.position.z=0,e.particleSystem.position.x=0,e.particleSystem.rotation.y+=e.dt/10}}}))}}document.addEventListener("mousemove",(function(e){m.targetX=e.clientX/u*m.ampX+m.cameraX,m.targetY=e.clientY/p*m.ampY+m.cameraY}),!1),function(){(e=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,100)).position.set(-.134952,3.965744,.182446),e.rotation.set(.013290999999999999,-.852159,-.090948),(t=new THREE.Scene).background=new THREE.Color("#fff7fe"),a=new THREE.AmbientLight(16777215,.8),t.add(a),t.add(PointLight),t.add(PointLight2),t.add(PointLight3),(new THREE.TextureLoader).load("/homepage/img/map3.jpg",(function(e){var n=new THREE.CylinderBufferGeometry(6,6,15,32),a=new THREE.MeshBasicMaterial({color:new THREE.Color("#fff7fe"),side:THREE.BackSide,map:e}),i=new THREE.Mesh(n,a);t.add(i)}));var i={loaded:0},r=function(e){var t=e.loaded,n=e.total;document.querySelector(".sliders__loading__count");if(n===t&&i.loaded++,3===i.loaded){var a=document.querySelector(".start"),r=document.querySelector(".sliders__loading");a.style.opacity=1,r.style.opacity=0}},o=new THREE.GLTFLoader;Promise.all(["/homepage/3d/Ткань.glb","/homepage/3d/Ткань2.glb","/homepage/3d/Ткань3.glb"].map((function(e){return new Promise((function(t,n){o.load(e,t,r,n)}))}))).then((function(e){e.forEach((function(e,n){e.scene.children.forEach((function(a){if("Mesh"===a.type){a.scale.x=2===n?.16:.1,a.scale.y=2===n?.16:.1,a.scale.z=2===n?.16:.1;if(a.position.y=[1.8890719999999999,-1.8699999999999999,.25][n],2===n){a.position.x=.19999999999999998}a.material=material,t.add(a),g.mixer.push(new THREE.AnimationMixer(a)),g.animations.push(e.animations)}}))})),g.animations.forEach((function(e,t){e.forEach((function(e){g.mixer[t].clipAction(e).reset().play()}))})),window.addEventListener("wheel",E),document.querySelector(".sliders").addEventListener("touchstart",b),document.querySelector(".sliders").addEventListener("touchmove",S)})),(n=new THREE.WebGLRenderer({antialias:!0,physicallyCorrectLights:!0})).setPixelRatio(window.devicePixelRatio),n.setSize(window.innerWidth,window.innerHeight),n.gammaFactor=2.2,n.gammaOutput=!0,l.appendChild(n.domElement),R.push(new Partykals.ParticlesSystem({container:t,particles:{startAlpha:1,endAlpha:0,size:new Partykals.Randomizers.MinMaxRandomizer(.045,.055),startAlphaChangeAt:0,ttl:7,offset:new Partykals.Randomizers.SphereRandomizer(5,5),globalColor:new THREE.Color("#feeaf4"),endColor:new THREE.Color("#ffffff"),worldPosition:!0,blending:"additive",texture:(new THREE.TextureLoader).load("/homepage/img/particle.png")},system:{particlesCount:2500,depthWrite:!1,emitters:new Partykals.Emitter({onInterval:new Partykals.Randomizers.MinMaxRandomizer(300,500),interval:new Partykals.Randomizers.MinMaxRandomizer(.2,.8)}),speed:1,onUpdate:function(e){e.particleSystem.rotation.y+=e.dt/300}}})),R.push(new Partykals.ParticlesSystem({container:t,particles:{startAlpha:1,endAlpha:0,size:new Partykals.Randomizers.MinMaxRandomizer(.045,.055),startAlphaChangeAt:0,ttl:7,offset:new Partykals.Randomizers.SphereRandomizer(4.2,4.2),globalColor:new THREE.Color("#feeaf4"),endColor:new THREE.Color("#ffffff"),worldPosition:!0,blending:"additive",texture:(new THREE.TextureLoader).load("/homepage/img/particle.png")},system:{particlesCount:1500,depthWrite:!1,emitters:new Partykals.Emitter({onInterval:new Partykals.Randomizers.MinMaxRandomizer(300,500),interval:new Partykals.Randomizers.MinMaxRandomizer(.2,.8)}),speed:1,onUpdate:function(e){e.particleSystem.rotation.y+=e.dt/100}}})),R.push(new Partykals.ParticlesSystem({container:t,particles:{startAlpha:1,endAlpha:0,size:new Partykals.Randomizers.MinMaxRandomizer(.045,.055),startAlphaChangeAt:0,ttl:7,offset:new Partykals.Randomizers.SphereRandomizer(3.8,3.8),globalColor:new THREE.Color("#feeaf4"),endColor:new THREE.Color("#ffffff"),worldPosition:!0,blending:"additive",texture:(new THREE.TextureLoader).load("/homepage/img/particle.png")},system:{particlesCount:1e3,depthWrite:!1,emitters:new Partykals.Emitter({onInterval:new Partykals.Randomizers.MinMaxRandomizer(300,500),interval:new Partykals.Randomizers.MinMaxRandomizer(.2,.8)}),speed:1,onUpdate:function(e){e.particleSystem.rotation.y+=e.dt/200}}})),window.addEventListener("resize",Y,!1),document.addEventListener("visibilitychange",w,!1)}(),function a(){requestAnimationFrame(a),function(){var a=c.getDelta(),i=y.playing;g.mixer&&g.animations&&g.mixer.forEach((function(e){return e.update(a/2)}));i||0!==m.targetX&&0!==m.targetY&&(e.position.x+=(m.targetX-e.position.x)*m.ease*16,e.position.y+=(m.targetY-e.position.y)*m.ease*16);R.forEach((function(e){return e.update()})),n.render(t,e)}()}();var v=0;function b(e){v=e.touches[0].pageY}function S(e){P({deltaY:v-e.touches[0].pageY})}function P(e){var t=y.playing,n=y.scroll,a=y.currentDressSlider;if(!t&&n){var i,r;switch(a){case 1:i=1,r=null;break;case 2:i=3,r=1;break;case 3:i=5,r=3}1===Math.sign(e.deltaY)?x(i,"next"):x(r,"prev")}}function X(e){if(!y.playing){var t=k(e.target.closest(".sliders__slider"));x(0===t?6:1===t?8:10,"next")}}function C(e){if(!y.playing){var t=k(e.target.closest(".content__section"));x(0===t?7:1===t?9:11,"next")}}function Z(e){var t=y.playing,n=y.index;if(!t){y.prevIndex=n;var a=k(e.target.closest(".menu__item")),i=0===a?5:1===a?1:3;document.querySelector(".burger").classList.remove("burger_opened"),hideMenu(),x(i,"next")}}function k(e){for(var t=0;e=e.previousElementSibling;)t++;return t}document.querySelector(".button-sound").addEventListener("click",(function(e){var t=e.target,n=t.classList.contains(".button-sound");"true"===(t=n?t:t.closest(".button-sound")).dataset.mute?(t.dataset.mute="false",f.setPlay()):(t.dataset.mute="true",f.setPause())})),document.querySelector(".start").addEventListener("click",(function(e){e.target.remove(),f.setPlay(),x(0,"next",!0)})),document.querySelectorAll(".sliders__slider button").forEach((function(e){return e.addEventListener("click",X)})),document.querySelectorAll(".content__close").forEach((function(e){return e.addEventListener("click",C)})),document.querySelector(".burger").addEventListener("click",(function(t){var n=t.target,a=n.classList.contains(".burger");n=a?n:n.closest(".burger");var i=y.playing,r=y.index;if(!i){if(n.classList.toggle("burger_opened"),12===r){x(13,"next")}else{y.prevCameraPosition.endX=e.position.x,y.prevCameraPosition.endY=e.position.y,y.prevCameraPosition.endZ=e.position.z,y.prevCameraPosition.endRX=e.rotation.x,y.prevCameraPosition.endRY=e.rotation.y,y.prevCameraPosition.endRZ=e.rotation.z,y.prevIndex=r;x(12,"next")}}})),document.querySelectorAll("div.menu__item").forEach((function(e){return e.addEventListener("click",Z)}));
